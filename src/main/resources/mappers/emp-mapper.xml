<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="empMapper">
	<resultMap type="com.study.test.emp.vo.EmpVO" id="emp">
		<id column="EMP_NO"	  property="empNo"/>
		<result column="EMP_TYPE" property="empType"/>
		<result column="MEM_NO"   property="memNo"/>
		<result column="DEPT_NO"  property="deptNo"/>
		<result column="COLL_NO"  property="collNo"/>
	</resultMap>

	<resultMap type="com.study.test.emp.vo.LectureVO" id="lecture">
		<id column="LEC_NO" 	 property="lecNo"/>
		<result column="LEC_NAME"    property="lecName"/>
		<result column="LEC_SCORE"   property="lecScore"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="MAX_NUM" 	 property="maxNum"/>
		<result column="NOW_NUM" 	 property="nowNum"/>
		<result column="LEC_STATUS"  property="lecStatus"/>
		<result column="EMP_NO" 	 property="empNo"/>
		<result column="SEM_NO" 	 property="semNo"/>
		<result column="COLL_NO" 	 property="collNo"/>
		<result column="DEPT_NO" 	 property="deptNo"/>
	</resultMap>
	
	<resultMap type="com.study.test.emp.vo.LectureTimeVO" id="lectureTime">
		<id column="TIME_NO"	 property="timeNo"/>
		<result column="LEC_DAY"	 property="lecDay"/>
		<result column="FIRST_TIME"  property="firstTime"/>
		<result column="LAST_TIME"   property="lastTime"/>
		<result column="LEC_NO"  	 property="lecNo"/>
	</resultMap>
	
	<!-- 강의 등록하기 위한 학기 이름 컬럼 조회 -->
	<select id="getSemesterNameForRegLecture">
		SELECT SEM_YEAR
			, SEM_NO
			, SEMESTER
		FROM SEMSTER
	</select>
	
	<!-- 다음에 들어갈 LEC_NO 조회 -->
	<select id="getNextLecNo" resultType="String">
		SELECT 'LEC_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(LEC_NO, 5))), 0) +1,3,0) FROM LECTURE
	</select>
	
	<!-- 강의 등록 -->
	<insert id="insertLecture">
		INSERT INTO LECTURE (
			LEC_NO
			, LEC_NAME
			, LEC_SCORE
			, MAX_NUM
			, NOW_NUM
			, EMP_NO
			, SEM_NO
			, COLL_NO
			, DEPT_NO
		) VALUES (
			#{lecNo}
			, #{lecName}
			, #{lecScore}
			, #{maxNum}
			, #{nowNum}
			, #{empNo}
			, #{semNo}
			, #{collNo}
			, #{deptNo}
		)
	</insert>
	
	<!-- 강의시간 테이블 등록 -->
	<insert id="regLectureTime">
		INSERT INTO LECTURE_TIME (
			TIME_NO
			, LEC_DAY
			, FIRST_TIME
			, LAST_TIME
			, LEC_NO
		) VALUES (
			(SELECT 'TIME_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(TIME_NO, 6))), 0) +1,3,0) FROM LECTURE_TIME)
			, #{lecDay}
			, #{firstTime}
			, #{lastTime}
			, #{lecNo}
		)
	</insert>
	
	<!-- 강의 시간표 작성 위한 강의 및 강의시간 조회 -->
	<select id="getLectureListForSchedule" resultType="HashMap">
		SELECT LEC_NAME
			, DEPT_NAME
			, FIRST_TIME
			, DECODE(LEC_DAY, '월', 1, '화', 2, '수', 3, '목', 4, '금', 5) LEC_DAY
		FROM LECTURE LEC, DEPT, LECTURE_TIME TIME 
		WHERE LEC.DEPT_NO = DEPT.DEPT_NO
		AND LEC.LEC_NO = TIME.LEC_NO
	</select>
	
	<!-- 강의 목록 조회 -->
	<select id="getLectureList" resultType="HashMap">
		SELECT LEC_NAME
			, LEC_SCORE
			, COLL_NAME
			, DEPT_NAME
		FROM LECTURE LEC, DEPT, COLLEAGE COLL 
		WHERE LEC.DEPT_NO = DEPT.DEPT_NO
		AND LEC.COLL_NO = COLL.COLL_NO
	</select>
	
	<!-- 강의등록시 전공대학 선택시 해당하는 전공학과 이름 조회 -->
	<select id="getDeptName" resultMap="colleageMapper.dept">
		SELECT DEPT_NAME
		FROM COLLEAGE COLL, DEPT
		WHERE #{collNo} = DEPT.COLL_NO
        AND COLL.COLL_NO = DEPT.COLL_NO
	</select>
	
</mapper>



























