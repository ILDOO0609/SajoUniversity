<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="stuMapper">

<resultMap type="com.study.test.stu.vo.StuVO" id="stu">
	<id 	column="STU_NO" 		property="stuNo"/>
	<result column="STU_YEAR" 		property="stuYear"/>
	<result column="STU_SEM" 		property="stuSem"/>
	<result column="STU_STATUS" 	property="stuStatus"/>
	<result column="MEM_NO" 		property="memNo"/>
	<result column="COLL_NO" 		property="collNo"/>
	<result column="DEPT_NO" 		property="deptNo"/>
	<association property="memberVO" resultMap="memberMapper.member"></association>
	<association property="colleageVO" resultMap="colleageMapper.colleage"></association>
	<association property="deptVO" resultMap="colleageMapper.dept"></association>
</resultMap>

<resultMap type="com.study.test.stu.vo.StatusInfoVO" id="status">
	<id 	column="STATUS_NO" 			property="statusNo"/>
	<result column="NOW_STATUS" 		property="nowStatus"/>
	<result column="AFTER_STATUS" 		property="afterStatus"/>
	<result column="APPLY_DATE" 		property="applyDate"/>
	<result column="APPROVAL_DATE" 		property="approvalDate"/>
	<result column="ING_STATUS" 		property="ingStatus"/>
	<result column="STU_NO" 			property="stuNo"/>
	<result column="STATUS_CONTENT" 	property="statusContent"/>
</resultMap>

<resultMap type="com.study.test.stu.vo.MultiMajorVO" id="multiMajor">
	<id 	column="MULTI_NO" 	property="multiNo"/>
	<result column="MULTI_DEPT" property="multiDept"/>
	<result column="MULTI_COLL" property="multiColl"/>
	<result column="STU_NO" 	property="stuNo"/>
</resultMap> 

<resultMap type="com.study.test.stu.vo.DeptManageVO" id="deptManage">
	<id 	column="APPLY_NO" 			property="applyNo"/>
	<result column="APPLY_CODE" 		property="applyCode"/>
	<result column="APPLY_DATE" 		property="applyDate"/>
	<result column="APPLY_REASON"	 	property="applyReason"/>
	<result column="APPROVAL_DATE" 		property="approvalDate"/>
	<result column="PROCESS_STATUS"	 	property="processStatus"/>
	<result column="STU_YEAR" 			property="stuYear"/>
	<result column="STU_SEM" 			property="stuSem"/>
	<result column="STU_NO" 			property="stuNo"/>
	<result column="FROM_COLL" 			property="fromColl"/>
	<result column="TO_COLL" 			property="toColl"/>
	<result column="FROM_DEPT" 			property="fromDept"/>
	<result column="TO_DEPT" 			property="toDept"/>
	<result column="MULTI_MAJOR_COLL" 	property="multiMajorColl"/>
	<result column="MULTI_MAJOR_DEPT" 	property="multiMajorDept"/>
</resultMap>

<select id="getStuInfo" resultMap="stu">
SELECT STU_NO
	, STU_YEAR
	, STU_SEM
	, STU_STATUS
	, MEM_NO
	, COLL_NO
	, DEPT_NO
FROM STU
WHERE MEM_NO = #{memNo}
</select>

<!--휴학 또는 휴학신청처리중인지 파악-->
<select id="getIngStatus" resultType="int">
SELECT COUNT(*)
FROM STATUS_INFO
WHERE STU_NO = #{stuNo}
AND ING_STATUS = 'I'
AND NOW_STATUS = 'E'
</select>

<!--휴학처리-->
<insert id="applyAbsence">
INSERT INTO STATUS_INFO (
	STATUS_NO
	, STU_NO
	, STATUS_CONTENT
	, AFTER_STATUS
) VALUES (
	(SELECT 'STATUS_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(STATUS_NO, 8))), 0) + 1, 3, '0') 
    FROM STATUS_INFO)
    , #{stuNo}
    , #{statusContent}
    , 'A'
)
</insert>

<!--복학신청 가능 여부 파악-->
<select id="getStatusRe" resultType="int">
SELECT COUNT(*)
FROM STATUS_INFO
WHERE STU_NO = #{stuNo}
AND NOW_STATUS = 'A'
</select>

<!--복학처리-->
<update id="updateStatusStuForRe">
UPDATE STATUS_INFO
SET ING_STATUS = 'I'
	, AFTER_STATUS = 'E'
WHERE STU_NO = #{stuNo}
</update>

<insert id="insertMultiMajor">
INSERT INTO 
</insert>

</mapper>


























